#!/usr/bin/env python

Import("env")

import main_builders

env.main_sources = []

env_main = env.Clone()

<<<<<<< HEAD
env_main.add_source_files(env.main_sources, "*.cpp")

if env["tests"]:
    env_main.Append(CPPDEFINES=["TESTS_ENABLED"])
=======
# Order matters here. Higher index controller database files write on top of lower index database files.
controller_databases = ["#main/gamecontrollerdb.txt", "#main/godotcontrollerdb.txt"]

env.Depends("#main/default_controller_mappings.gen.cpp", controller_databases)
env.CommandNoCache(
    "#main/default_controller_mappings.gen.cpp",
    controller_databases,
    run_in_subprocess(main_builders.make_default_controller_mappings),
)
>>>>>>> audio-bus-effect-fixed

env_main.Depends("#main/splash.gen.h", "#main/splash.png")
env_main.CommandNoCache(
    "#main/splash.gen.h",
    "#main/splash.png",
    env.Run(main_builders.make_splash, "Building splash screen header."),
)

env_main.Depends("#main/splash_editor.gen.h", "#main/splash_editor.png")
env_main.CommandNoCache(
    "#main/splash_editor.gen.h",
    "#main/splash_editor.png",
    env.Run(main_builders.make_splash_editor, "Building editor splash screen header."),
)

<<<<<<< HEAD
env_main.Depends("#main/app_icon.gen.h", "#main/app_icon.png")
env_main.CommandNoCache(
    "#main/app_icon.gen.h",
    "#main/app_icon.png",
    env.Run(main_builders.make_app_icon, "Building application icon."),
)

lib = env_main.add_library("main", env.main_sources)
=======
env.Depends("#main/splash_editor.gen.h", "#main/splash_editor.png")
env.CommandNoCache(
    "#main/splash_editor.gen.h", "#main/splash_editor.png", run_in_subprocess(main_builders.make_splash_editor)
)

env.Depends("#main/app_icon.gen.h", "#main/app_icon.png")
env.CommandNoCache("#main/app_icon.gen.h", "#main/app_icon.png", run_in_subprocess(main_builders.make_app_icon))

if env["tools"]:
    SConscript("tests/SCsub")

lib = env.add_library("main", env.main_sources)
>>>>>>> audio-bus-effect-fixed
env.Prepend(LIBS=[lib])
