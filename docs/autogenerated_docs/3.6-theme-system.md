# Theme System

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [doc/classes/Control.xml](https://github.com/godotengine/godot/blob/4219ce91/doc/classes/Control.xml)
- [doc/classes/Node.xml](https://github.com/godotengine/godot/blob/4219ce91/doc/classes/Node.xml)
- [doc/classes/SceneTree.xml](https://github.com/godotengine/godot/blob/4219ce91/doc/classes/SceneTree.xml)
- [doc/classes/Theme.xml](https://github.com/godotengine/godot/blob/4219ce91/doc/classes/Theme.xml)
- [doc/classes/Viewport.xml](https://github.com/godotengine/godot/blob/4219ce91/doc/classes/Viewport.xml)
- [doc/classes/Window.xml](https://github.com/godotengine/godot/blob/4219ce91/doc/classes/Window.xml)
- [scene/gui/control.cpp](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp)
- [scene/gui/control.h](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.h)
- [scene/main/node.cpp](https://github.com/godotengine/godot/blob/4219ce91/scene/main/node.cpp)
- [scene/main/node.h](https://github.com/godotengine/godot/blob/4219ce91/scene/main/node.h)
- [scene/main/scene_tree.cpp](https://github.com/godotengine/godot/blob/4219ce91/scene/main/scene_tree.cpp)
- [scene/main/scene_tree.h](https://github.com/godotengine/godot/blob/4219ce91/scene/main/scene_tree.h)
- [scene/main/viewport.cpp](https://github.com/godotengine/godot/blob/4219ce91/scene/main/viewport.cpp)
- [scene/main/viewport.h](https://github.com/godotengine/godot/blob/4219ce91/scene/main/viewport.h)
- [scene/main/window.cpp](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp)
- [scene/main/window.h](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.h)
- [scene/resources/theme.cpp](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.cpp)
- [scene/resources/theme.h](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.h)

</details>



## Purpose and Scope

The theme system provides a centralized styling mechanism for GUI controls in Godot. It allows defining visual properties (colors, fonts, icons, styleboxes, constants) that are automatically applied to `Control` and `Window` nodes throughout the scene tree. This document covers the `Theme` resource structure, theme item lookup, propagation hierarchy, and integration with the GUI system.

For information about specific GUI controls and their properties, see [Control Base Class and Layout](#3.1). For details about the scene tree structure, see [SceneTree and Node Hierarchy](#2.1).

---

## Theme Resource Architecture

### Theme Data Structure

The `Theme` class ([scene/resources/theme.h:38-230]()) is a `Resource` that stores theme items organized by theme type (typically a class name like "Button" or "Label") and data type.

**Theme Data Organization:**

```mermaid
graph TB
    Theme["Theme Resource"]
    
    subgraph "Data Type Categories"
        Icons["icon_map<br/>HashMap&lt;StringName, ThemeIconMap&gt;"]
        Styles["style_map<br/>HashMap&lt;StringName, ThemeStyleMap&gt;"]
        Fonts["font_map<br/>HashMap&lt;StringName, ThemeFontMap&gt;"]
        FontSizes["font_size_map<br/>HashMap&lt;StringName, ThemeFontSizeMap&gt;"]
        Colors["color_map<br/>HashMap&lt;StringName, ThemeColorMap&gt;"]
        Constants["constant_map<br/>HashMap&lt;StringName, ThemeConstantMap&gt;"]
    end
    
    subgraph "Per Theme Type"
        ButtonIcons["'Button' -> HashMap&lt;StringName, Ref&lt;Texture2D&gt;&gt;"]
        LabelColors["'Label' -> HashMap&lt;StringName, Color&gt;"]
        PanelStyles["'Panel' -> HashMap&lt;StringName, Ref&lt;StyleBox&gt;&gt;"]
    end
    
    subgraph "Per Item Name"
        IconNormal["'icon' -> Ref&lt;Texture2D&gt;"]
        ColorFont["'font_color' -> Color"]
        StylePanel["'panel' -> Ref&lt;StyleBox&gt;"]
    end
    
    Theme --> Icons
    Theme --> Styles
    Theme --> Fonts
    Theme --> FontSizes
    Theme --> Colors
    Theme --> Constants
    
    Icons --> ButtonIcons
    Colors --> LabelColors
    Styles --> PanelStyles
    
    ButtonIcons --> IconNormal
    LabelColors --> ColorFont
    PanelStyles --> StylePanel
```

**Sources:** [scene/resources/theme.h:49-64](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.h#L49-L64), [scene/resources/theme.h:104-120](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.h#L104-L120)

### Theme Item Data Types

Six distinct data types are supported, defined in `Theme::DataType` enum:

| Data Type | Storage Type | Example Usage |
|-----------|--------------|---------------|
| `DATA_TYPE_COLOR` | `Color` | Font colors, border colors |
| `DATA_TYPE_CONSTANT` | `int` | Spacing, margins, separations |
| `DATA_TYPE_FONT` | `Ref<Font>` | Text rendering fonts |
| `DATA_TYPE_FONT_SIZE` | `int` | Font point sizes |
| `DATA_TYPE_ICON` | `Ref<Texture2D>` | Button icons, checkmarks |
| `DATA_TYPE_STYLEBOX` | `Ref<StyleBox>` | Background panels, borders |

**Theme Item Access Pattern:**

```mermaid
graph LR
    Request["get_theme_item()"]
    ThemeType["Theme Type<br/>'Button'"]
    ItemName["Item Name<br/>'font_color'"]
    DataType["Data Type<br/>COLOR"]
    
    Request --> ThemeType
    Request --> ItemName
    Request --> DataType
    
    ThemeType --> Lookup["theme_type_map[theme_type]"]
    Lookup --> ItemMap["item_map[item_name]"]
    ItemMap --> Value["Return Value"]
```

**Sources:** [scene/resources/theme.h:56-64](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.h#L56-L64), [scene/resources/theme.cpp:36-66](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.cpp#L36-L66)

---

## Theme Ownership and Propagation

### Theme Hierarchy

Themes propagate through the scene tree using a hierarchical lookup system. Each `Control` and `Window` can specify a theme, and nodes without an explicit theme inherit from their ancestors.

```mermaid
graph TB
    ThemeDB["ThemeDB Singleton<br/>Global theme management"]
    ProjectTheme["Project Theme<br/>ProjectSettings.gui/theme/custom"]
    DefaultTheme["Default Theme<br/>Built-in fallback"]
    
    RootWindow["Window (Root)<br/>theme = custom_theme"]
    ParentControl["Control A<br/>theme = null"]
    ChildControl["Control B<br/>theme = null"]
    OverrideControl["Control C<br/>theme = override_theme"]
    
    ThemeDB --> ProjectTheme
    ThemeDB --> DefaultTheme
    
    RootWindow --> ParentControl
    ParentControl --> ChildControl
    ParentControl --> OverrideControl
    
    ChildControl -."|lookup|".-> ParentControl
    ParentControl -."|lookup|".-> RootWindow
    RootWindow -."|lookup|".-> ProjectTheme
    ProjectTheme -."|lookup|".-> DefaultTheme
    
    OverrideControl -."|lookup|".-> ProjectTheme
```

**Sources:** [scene/gui/control.cpp:460-507](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L460-L507), [scene/main/window.cpp:237-291](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L237-L291)

### Theme Owner Management

The theme system uses `ThemeOwner` (mentioned in [scene/gui/control.h:42]() and [scene/main/window.h:40]()) to manage theme propagation. When a node's theme changes, it notifies all descendants that inherit from it.

**Theme Change Propagation:**

```mermaid
sequenceDiagram
    participant Control as Control Node
    participant ThemeOwner as ThemeOwner
    participant Children as Child Nodes
    
    Control->>Control: set_theme(new_theme)
    Control->>ThemeOwner: Assign new theme
    ThemeOwner->>ThemeOwner: _propagate_theme_changed()
    ThemeOwner->>Children: Notify theme changed
    Children->>Children: Update theme cache
    Children->>Children: Queue redraw
```

**Sources:** [scene/gui/control.cpp:2863-2906](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L2863-L2906), [scene/theme/theme_owner.h](https://github.com/godotengine/godot/blob/4219ce91/scene/theme/theme_owner.h) (referenced)

---

## Theme Item Lookup Process

### Lookup Order

When a control requests a theme item, the system searches through multiple sources in priority order:

1. **Local overrides** - `theme_*_override` properties on the node
2. **Node theme** - `theme` property on the control/window
3. **Parent themes** - Inherited from parent controls/windows
4. **Theme type variation** - Custom type specified by `theme_type_variation`
5. **Project theme** - `ThemeDB` project-level theme
6. **Default theme** - `ThemeDB` built-in fallback theme

```mermaid
graph TB
    Request["Control.get_theme_color('font_color')"]
    
    Step1["1. Check local override<br/>theme_color_override['font_color']"]
    Step2["2. Check node theme<br/>control.theme"]
    Step3["3. Check parent chain<br/>parent->get_theme()"]
    Step4["4. Check type variation<br/>theme_type_variation lookup"]
    Step5["5. Check project theme<br/>ThemeDB.project_theme"]
    Step6["6. Check default theme<br/>ThemeDB.default_theme"]
    
    Found["Return value"]
    NotFound["Return default value"]
    
    Request --> Step1
    Step1 -->|"Has override"| Found
    Step1 -->|"No override"| Step2
    Step2 -->|"Has theme"| Found
    Step2 -->|"No theme"| Step3
    Step3 -->|"Parent has"| Found
    Step3 -->|"No parent"| Step4
    Step4 -->|"Has variation"| Found
    Step4 -->|"No variation"| Step5
    Step5 -->|"Has item"| Found
    Step5 -->|"Not found"| Step6
    Step6 -->|"Has item"| Found
    Step6 -->|"Not found"| NotFound
```

**Sources:** [scene/gui/control.cpp:2485-2653](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L2485-L2653), [scene/main/window.cpp:735-876](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L735-L876)

### Theme Item Methods

Controls expose methods for accessing theme items with automatic type safety:

| Method Pattern | Return Type | Example |
|----------------|-------------|---------|
| `get_theme_color(name, theme_type)` | `Color` | Font colors |
| `get_theme_constant(name, theme_type)` | `int` | Spacing values |
| `get_theme_font(name, theme_type)` | `Ref<Font>` | Text fonts |
| `get_theme_font_size(name, theme_type)` | `int` | Font sizes |
| `get_theme_icon(name, theme_type)` | `Ref<Texture2D>` | Icons |
| `get_theme_stylebox(name, theme_type)` | `Ref<StyleBox>` | Backgrounds |

Each method has a corresponding `has_theme_*()` variant to check existence without returning a default value.

**Sources:** [scene/gui/control.h:412-433](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.h#L412-L433), [scene/gui/control.cpp:2485-2653](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L2485-L2653)

---

## Theme Overrides

### Local Override System

Both `Control` and `Window` support local theme overrides that take precedence over all inherited themes. These are stored in hash maps within the node's data structure.

**Override Storage:**

```mermaid
graph TB
    ControlData["Control.data"]
    
    subgraph "Override Maps"
        IconOverride["theme_icon_override<br/>HashMap&lt;StringName, Ref&lt;Texture2D&gt;&gt;"]
        StyleOverride["theme_style_override<br/>HashMap&lt;StringName, Ref&lt;StyleBox&gt;&gt;"]
        FontOverride["theme_font_override<br/>HashMap&lt;StringName, Ref&lt;Font&gt;&gt;"]
        FontSizeOverride["theme_font_size_override<br/>HashMap&lt;StringName, int&gt;"]
        ColorOverride["theme_color_override<br/>HashMap&lt;StringName, Color&gt;"]
        ConstantOverride["theme_constant_override<br/>HashMap&lt;StringName, int&gt;"]
    end
    
    ControlData --> IconOverride
    ControlData --> StyleOverride
    ControlData --> FontOverride
    ControlData --> FontSizeOverride
    ControlData --> ColorOverride
    ControlData --> ConstantOverride
```

**Sources:** [scene/gui/control.h:245-250](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.h#L245-L250), [scene/main/window.h:111-116](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.h#L111-L116)

### Dynamic Override Properties

Overrides are exposed as dynamic properties using the `theme_override_*` naming convention. The engine handles these through `_set()` and `_get()` methods.

**Property Pattern:**
- `theme_override_colors/font_color` - Color override
- `theme_override_constants/margin` - Constant override
- `theme_override_fonts/font` - Font override
- `theme_override_font_sizes/font_size` - Font size override
- `theme_override_icons/icon` - Icon override
- `theme_override_styles/panel` - StyleBox override

**Override Management Methods:**

```mermaid
graph LR
    Add["add_theme_*_override()"]
    Remove["remove_theme_*_override()"]
    Check["has_theme_*_override()"]
    
    Override["Override Map"]
    
    Add --> Override
    Remove --> Override
    Check --> Override
    
    Override --> Notify["_notify_theme_override_changed()"]
    Notify --> Update["Update theme cache"]
    Notify --> Redraw["Queue redraw"]
```

**Sources:** [scene/gui/control.cpp:295-398](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L295-L398), [scene/main/window.cpp:52-154](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L52-L154)

---

## Type Variations

### Theme Type Variation System

Type variations allow creating themed variants of base types without duplicating theme definitions. For example, a "FlatButton" variation can inherit from "Button" but override specific items.

**Type Variation Hierarchy:**

```mermaid
graph TB
    BaseType["Base Type: 'Button'"]
    Variation1["Type Variation: 'FlatButton'"]
    Variation2["Type Variation: 'RaisedButton'"]
    
    BaseItems["Base Theme Items:<br/>- normal StyleBox<br/>- hover StyleBox<br/>- font_color Color"]
    
    Var1Items["Override Items:<br/>- normal = flat_style<br/>(inherits others)"]
    
    Var2Items["Override Items:<br/>- normal = raised_style<br/>- pressed = pressed_style<br/>(inherits others)"]
    
    BaseType --> BaseItems
    BaseType --> Variation1
    BaseType --> Variation2
    
    Variation1 --> Var1Items
    Variation2 --> Var2Items
```

The `theme_type_variation` property on `Control` ([scene/gui/control.h:233]()) specifies which variation to use. When looking up theme items, the system first checks the variation type, then falls back to the base type.

**Variation Lookup in Theme:**

```mermaid
sequenceDiagram
    participant Control as Control
    participant Theme as Theme
    participant TypeVar as Variation Map
    
    Control->>Control: get_theme_stylebox("normal")
    Control->>Control: Check theme_type_variation
    Control->>Theme: get_stylebox("normal", "FlatButton")
    Theme->>TypeVar: Check variation_map["FlatButton"]
    TypeVar->>Theme: Base type = "Button"
    Theme->>Theme: Look in "FlatButton" items
    alt Found in variation
        Theme->>Control: Return variation item
    else Not found
        Theme->>Theme: Look in "Button" items
        Theme->>Control: Return base item
    end
```

**Sources:** [scene/resources/theme.cpp:143-198](https://github.com/godotengine/godot/blob/4219ce91/scene/resources/theme.cpp#L143-L198), [scene/gui/control.cpp:460-507](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L460-L507)

---

## Integration with Control and Window

### Control Theme Integration

The `Control` class maintains a theme cache (`theme_cache` structure) that is populated when the theme changes, avoiding repeated lookups during rendering.

**Control Theme Cache Structure:**

```mermaid
graph TB
    Control["Control Node"]
    ThemeCache["theme_cache struct"]
    
    subgraph "Cached Theme Items"
        CachedFont["Ref&lt;Font&gt; font"]
        CachedFontSize["int font_size"]
        CachedColor["Color font_color"]
        CachedStyle["Ref&lt;StyleBox&gt; panel"]
        CachedIcon["Ref&lt;Texture2D&gt; icon"]
        CachedConstant["int separation"]
    end
    
    Control --> ThemeCache
    ThemeCache --> CachedFont
    ThemeCache --> CachedFontSize
    ThemeCache --> CachedColor
    ThemeCache --> CachedStyle
    ThemeCache --> CachedIcon
    ThemeCache --> CachedConstant
    
    Update["_update_theme_item_cache()"]
    Update -.populates.-> ThemeCache
```

Each `Control` subclass defines its own theme cache structure specific to its visual needs. The `_update_theme_item_cache()` virtual method ([scene/gui/control.h:333]()) is called when the theme changes, allowing controls to refresh their cached items.

**Sources:** [scene/gui/control.h:220-221](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.h#L220-L221), [scene/gui/control.cpp:2863-2906](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L2863-L2906)

### Window Theme Integration

`Window` nodes also participate in the theme system, supporting theme overrides for embedded window styling (title bars, close buttons, borders).

**Window-Specific Theme Items:**

| Item Name | Type | Purpose |
|-----------|------|---------|
| `embedded_border` | StyleBox | Border when embedded |
| `embedded_unfocused_border` | StyleBox | Border when not focused |
| `title_font` | Font | Title bar font |
| `title_font_size` | int | Title bar font size |
| `title_color` | Color | Title text color |
| `title_outline_modulate` | Color | Title outline color |
| `title_height` | int | Title bar height |
| `close` | Texture2D | Close button icon |
| `close_pressed` | Texture2D | Pressed close button |

**Sources:** [scene/main/window.cpp:328-384](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L328-L384), [scene/main/window.h:98-104](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.h#L98-L104)

### Theme Notification System

When themes change, affected nodes receive notifications to update their cached values and visuals:

```mermaid
graph TB
    ThemeChange["Theme Changed Event"]
    
    Notify["NOTIFICATION_THEME_CHANGED"]
    Update["_update_theme_item_cache()"]
    Redraw["queue_redraw()"]
    MinSize["update_minimum_size()"]
    
    ThemeChange --> Notify
    Notify --> Update
    Update --> Redraw
    Update --> MinSize
```

The `NOTIFICATION_THEME_CHANGED` notification ([scene/gui/control.h:376]()) triggers theme cache updates. Controls respond by calling `_update_theme_item_cache()` and requesting a redraw.

**Sources:** [scene/gui/control.cpp:355-387](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L355-L387), [scene/main/window.cpp:1395-1413](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L1395-L1413)

---

## ThemeDB Singleton

### Global Theme Management

`ThemeDB` (referenced in [scene/theme/theme_db.h]() includes at [scene/gui/control.cpp:43]() and [scene/main/window.cpp:37]()) manages project-wide and default themes. It provides a centralized access point for theme data.

**ThemeDB Architecture:**

```mermaid
graph TB
    ThemeDB["ThemeDB Singleton"]
    
    DefaultTheme["default_theme<br/>Built-in fallback"]
    ProjectTheme["project_theme<br/>From ProjectSettings"]
    
    ClassItems["Class Theme Items Database<br/>get_class_items()"]
    
    ThemeDB --> DefaultTheme
    ThemeDB --> ProjectTheme
    ThemeDB --> ClassItems
    
    Control["Control Nodes"]
    Window["Window Nodes"]
    Theme["Theme Resources"]
    
    Control -.uses.-> ThemeDB
    Window -.uses.-> ThemeDB
    Theme -.queries.-> ClassItems
```

**ThemeDB Responsibilities:**
1. Store and provide access to the default theme
2. Store and provide access to the project theme from `ProjectSettings.gui/theme/custom`
3. Maintain a database of valid theme items per class (used for editor property lists)
4. Handle theme initialization during engine startup

**Sources:** [scene/gui/control.cpp:402-403](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L402-L403), [scene/main/window.cpp:159](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L159)

---

## Theme Item Registration

### Editor Property Generation

The theme system uses `ThemeDB` to generate property lists for the editor. When a `Control` or `Window` is inspected, the engine queries all valid theme items for that class and exposes them as checkable override properties.

**Property List Generation:**

```mermaid
sequenceDiagram
    participant Inspector as EditorInspector
    participant Control as Control Node
    participant ThemeDB as ThemeDB
    
    Inspector->>Control: _get_property_list()
    Control->>ThemeDB: get_class_items(get_class_name())
    ThemeDB->>Control: List of ThemeItemBind
    Control->>Control: For each item, add property
    Control->>Control: Check if override exists
    Control->>Inspector: PropertyInfo with CHECKABLE flag
```

Each theme item appears in the inspector as a checkable property. When checked, the override is stored; when unchecked, it's removed.

**Sources:** [scene/gui/control.cpp:400-458](https://github.com/godotengine/godot/blob/4219ce91/scene/gui/control.cpp#L400-L458), [scene/main/window.cpp:156-235](https://github.com/godotengine/godot/blob/4219ce91/scene/main/window.cpp#L156-L235)

### Theme Item Validation

The `_validate_property()` method ([scene/gui/control.cpp:460-624](), [scene/main/window.cpp:237-292]()) updates theme-related properties dynamically based on the current theme hierarchy. For example, `theme_type_variation` hints are populated with available variations from all themes in the hierarchy.